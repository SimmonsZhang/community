<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="life.majiang.community.mapper.QuestionMapper">
    <resultMap id="questionDtoMap" type="life.majiang.community.dto.QuestionDto">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="description" property="description"/>
        <result column="gmt_create" property="gmtCreate"/>
        <result column="gmt_modified" property="gmtModified"/>
        <result column="comment_count" property="commentCount"/>
        <result column="view_count" property="viewCount"/>
        <result column="like_count" property="likeCount"/>
        <result column="tag" property="tag"/>
        <result column="creator" property="creator"/>
        <association property="user" javaType="life.majiang.community.model.User">
            <id column="user_id" property="id"/>
            <result column="user_account_id" property="accountId"/>
            <result column="user_name" property="name"/>
            <result column="user_token" property="token"/>
            <result column="user_gmt_create" property="gmtCreate"/>
            <result column="user_gmt_modified" property="gmtModified"/>
            <result column="user_bio" property="bio"/>
            <result column="user_avatar_url" property="avatarUrl"/>
        </association>
    </resultMap>

    <insert id="create" parameterType="life.majiang.community.model.Question">
      insert into question
      (id,title,description,gmt_create,gmt_modified,tag,creator) values
      (#{id},#{title},#{description},#{gmtCreate},#{gmtModified},#{tag},#{creator})
    </insert>

    <select id="listWithAvatar" resultMap="questionDtoMap">
      select
             q.*,
             u.id as user_id,
             u.account_id as user_account_id,
             u.name as user_name,
             u.token as user_token,
             u.gmt_create as user_gmt_create,
             u.gmt_modified as user_gmt_modified,
             u.bio as user_bio,
             u.avatar_url as user_avatar_url
      from
           question q,user u
      where
            q.creator = u.id
    </select>

    <select id="listByCreator" resultMap="questionDtoMap" parameterType="int">
        select
            q.*,
            u.id as user_id,
            u.account_id as user_account_id,
            u.name as user_name,
            u.token as user_token,
            u.gmt_create as user_gmt_create,
            u.gmt_modified as user_gmt_modified,
            u.bio as user_bio,
            u.avatar_url as user_avatar_url
        from
            question q,user u
        where
            q.creator = #{creator} and q.creator = u.id
    </select>

    <select id="listById" resultMap="questionDtoMap" parameterType="int">
        select
               q.*,
               u.id as user_id,
               u.account_id as user_account_id,
               u.name as user_name,
               u.token as user_token,
               u.gmt_create as user_gmt_create,
               u.gmt_modified as user_gmt_modified,
               u.bio as user_bio,
               u.avatar_url as user_avatar_url
        from
             question q,user u
        where
              q.id=#{id} and q.creator=u.id
    </select>

    <update id="update" parameterType="life.majiang.community.model.Question">
    <!--<update id="update" parameterMap="questionDtoMap">-->
        update
          question q
        set
            q.title=#{title},
            q.description=#{description},
            q.tag=#{tag},
            q.gmt_modified=#{gmtModified}
        where
              q.id=#{id}
    </update>
    

</mapper>